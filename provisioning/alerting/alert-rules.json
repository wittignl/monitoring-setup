{
  "apiVersion": 1,
  "groups": [
    {
      "orgId": 1,
      "name": "DISK web alert",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "disk-web-alert",
          "title": "DISK web",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 300,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "1 - node_filesystem_free_bytes{job='node',fstype!='rootfs',mountpoint=\"/\"} / node_filesystem_size_bytes{job='node',mountpoint=\"/\"}",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        0.8,
                        0
                      ],
                      "type": "gt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "avg"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "hide": false,
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "dashboardUid": "dashboard-alerts",
          "panelId": 20,
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "__dashboardUid__": "dashboard-alerts",
            "__panelId__": "20",
            "description": "Disk usage on {{$labels.instance}} is above 80%",
            "summary": "High disk usage on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "DISK web ALERT",
            "instance": "{{$labels.instance}}",
            "severity": "warning"
          },
          "isPaused": false
        }
      ]
    },
    {
      "name": "LOAD web alert",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "load-web-alert",
          "title": "LOAD web",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 1800,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "expr": "node_load1",
                "range": true,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        4
                      ],
                      "type": "gt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "avg"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "dashboardUid": "dashboard-alerts",
          "panelId": 12,
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "description": "System load on {{$labels.instance}} averaged over 30 minutes is above 4",
            "summary": "High system load on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "LOAD web ALERT",
            "instance": "{{$labels.instance}}",
            "severity": "warning"
          }
        }
      ]
    },
    {
      "orgId": 1,
      "name": "MEMORY web alert",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "memory-web-alert",
          "title": "MEMORY web",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "(node_memory_MemTotal_bytes{job='node'} - node_memory_MemFree_bytes{job='node'} - node_memory_Buffers_bytes{job='node'} - node_memory_Cached_bytes{job='node'}) / node_memory_MemTotal_bytes{job='node'}",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        0.95,
                        0
                      ],
                      "type": "gt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "avg"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "dashboardUid": "dashboard-alerts",
          "panelId": 16,
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "__dashboardUid__": "dashboard-alerts",
            "__panelId__": "16",
            "description": "Memory usage on {{$labels.instance}} is above 95%",
            "summary": "High memory usage on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "MEMORY web alert",
            "instance": "{{$labels.instance}}",
            "severity": "warning"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "PROCESS web alert",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "process-web-alert",
          "title": "PROCESS web1",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 60,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "sum(pm2_up{job=\"pm2\",name!~\"stg-(.*)|pm2_(.*)\"}) by (name)",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        1,
                        0
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "dashboardUid": "dashboard-alerts",
          "panelId": 28,
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "__dashboardUid__": "dashboard-alerts",
            "__panelId__": "28",
            "description": "PM2 process {{ $labels.process }} is down on {{ $labels.instance }}",
            "summary": "PM2 process {{ $labels.process }} down on {{ $labels.instance }}"
          },
          "labels": {
            "alertname": "PROCESS web ALERT",
            "instance": "{{$labels.instance}}",
            "process": "{{$labels.name}}",
            "severity": "critical"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "SSL Certificate",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "ssl-certificate-alert",
          "title": "SSL Certificate",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "(probe_ssl_earliest_cert_expiry - time()) / 86400",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        7,
                        0
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "1m",
          "annotations": {
            "description": "SSL certificate for {{$labels.instance}} will expire in less than 7 days",
            "summary": "SSL certificate expiring soon for {{$labels.instance}}"
          },
          "labels": {
            "alertname": "SSL Certificate Expiry",
            "instance": "{{$labels.instance}}",
            "severity": "warning"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "UP MySQL ALERT",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "up_mysql_alert",
          "title": "UP MySQL",
          "condition": "C",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 60,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "mysql_up{job=\"mysql\"}",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 300,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "editorMode": "code",
                "expr": "mysql_up{job=\"mysql\"}",
                "hide": false,
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "B"
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        1,
                        0
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "avg"
                    },
                    "type": "query"
                  },
                  {
                    "evaluator": {
                      "params": [
                        0,
                        0
                      ],
                      "type": "no_value"
                    },
                    "operator": {
                      "type": "or"
                    },
                    "query": {
                      "params": [
                        "B"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "hide": false,
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "C",
                "type": "classic_conditions"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "description": "MySQL on {{$labels.instance}} is down",
            "summary": "MySQL down on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "UP MySQL ALERT",
            "instance": "{{$labels.instance}}",
            "severity": "critical"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "UP web ALERT",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "up_web_alert",
          "title": "UP web",
          "condition": "C",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 60,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "up{job=\"node\"}",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 300,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "datasource": {
                  "type": "prometheus",
                  "uid": "prometheus"
                },
                "editorMode": "code",
                "expr": "up{job=\"node\"}",
                "hide": false,
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "B"
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        1,
                        0
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  },
                  {
                    "evaluator": {
                      "params": [
                        0,
                        0
                      ],
                      "type": "no_value"
                    },
                    "operator": {
                      "type": "or"
                    },
                    "query": {
                      "params": [
                        "B"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "hide": false,
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "C",
                "type": "classic_conditions"
              }
            }
          ],
          "dashboardUid": "dashboard-alerts",
          "panelId": 8,
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "__dashboardUid__": "dashboard-alerts",
            "__panelId__": "8",
            "description": "Node exporter on {{$labels.instance}} is down",
            "summary": "Node exporter down on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "UP web ALERT",
            "instance": "{{$labels.instance}}",
            "severity": "critical"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "Duplicati Backup Failed",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "duplicati-alert",
          "title": "Duplicati Backup Failed",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "duplicati_backup_status",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        1,
                        0
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "description": "Duplicati backup on {{$labels.instance}} has failed",
            "summary": "Duplicati backup failed on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "Duplicati backup failed",
            "instance": "{{$labels.instance}}",
            "severity": "warning"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "Beanstalkd Alerts",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "beanstalkd-down-alert",
          "title": "Beanstalkd Down",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 300,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "beanstalkd_up{job=\"beanstalkd\"}",
                "instant": true,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": false,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        1
                      ],
                      "type": "lt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "$A < 1",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "5m",
          "annotations": {
            "description": "Beanstalkd instance on {{$labels.instance}} is down.",
            "summary": "Beanstalkd instance down on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "Beanstalkd Down",
            "instance": "{{$labels.instance}}",
            "severity": "critical"
          },
          "isPaused": false
        },
        {
          "uid": "beanstalkd-queue-length-alert",
          "title": "Beanstalkd High Queue Length",
          "condition": "B",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 600,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "beanstalkd_tube_current_jobs_ready{job=\"beanstalkd\"}",
                "instant": false,
                "intervalMs": 1000,
                "legendFormat": "__auto",
                "maxDataPoints": 43200,
                "range": true,
                "refId": "A"
              }
            },
            {
              "refId": "B",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        100
                      ],
                      "type": "gt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "A"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "name": "Expression",
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "$A > 100",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "B",
                "type": "classic_conditions"
              }
            }
          ],
          "noDataState": "NoData",
          "execErrState": "Error",
          "for": "10m",
          "annotations": {
            "description": "Beanstalkd tube {{$labels.tube}} on instance {{$labels.instance}} has over 100 jobs ready.",
            "summary": "High queue length for tube {{$labels.tube}} on {{$labels.instance}}"
          },
          "labels": {
            "alertname": "Beanstalkd High Queue Length",
            "instance": "{{$labels.instance}}",
            "tube": "{{$labels.tube}}",
            "severity": "warning"
          },
          "isPaused": false
        }
      ]
    },
    {
      "orgId": 1,
      "name": "MySQL slow queries",
      "folder": "General Alerting",
      "interval": "1m",
      "rules": [
        {
          "uid": "mysql-slow-queries-alert",
          "title": "MySQL Slow queries",
          "condition": "C",
          "data": [
            {
              "refId": "A",
              "relativeTimeRange": {
                "from": 3600,
                "to": 0
              },
              "datasourceUid": "prometheus",
              "model": {
                "editorMode": "code",
                "expr": "sum(rate(mysql_global_status_slow_queries{job=~\".+\", instance=~\".+\"}[$__rate_interval]))",
                "format": "time_series",
                "instant": true,
                "interval": "1m",
                "intervalFactor": 1,
                "intervalMs": 15000,
                "legendFormat": "Slow Queries",
                "maxDataPoints": 43200,
                "metric": "",
                "range": false,
                "refId": "A",
                "step": 20
              }
            },
            {
              "refId": "C",
              "relativeTimeRange": {
                "from": 0,
                "to": 0
              },
              "datasourceUid": "__expr__",
              "model": {
                "conditions": [
                  {
                    "evaluator": {
                      "params": [
                        0
                      ],
                      "type": "gt"
                    },
                    "operator": {
                      "type": "and"
                    },
                    "query": {
                      "params": [
                        "C"
                      ]
                    },
                    "reducer": {
                      "params": [],
                      "type": "last"
                    },
                    "type": "query"
                  }
                ],
                "datasource": {
                  "type": "__expr__",
                  "uid": "__expr__"
                },
                "expression": "A",
                "intervalMs": 1000,
                "maxDataPoints": 43200,
                "refId": "C",
                "type": "threshold"
              }
            }
          ],
          "dashboardUid": "dashboard-mysql-full",
          "panelId": 48,
          "noDataState": "NoData",
          "execErrState": "Alerting",
          "for": "1m",
          "annotations": {
            "__dashboardUid__": "dashboard-mysql-full",
            "__panelId__": "48"
          },
          "isPaused": false
        }
      ]
    }
  ]
}
